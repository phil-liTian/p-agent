# 项目风格约束

## TypeScript 处理规范

### 项目配置
- 使用 TypeScript 作为主要开发语言
- 配置 `tsconfig.json` 文件，确保严格类型检查
- 使用 `strict: true` 启用所有严格类型检查选项
- 启用 `noImplicitAny`, `strictNullChecks`, `strictFunctionTypes` 等选项

### 代码风格
- 使用 TypeScript 接口和类型定义明确数据结构
- 避免使用 `any` 类型，优先使用具体的类型定义
- 使用枚举（enum）定义常量集合
- 使用泛型提高代码复用性和类型安全
- 使用访问修饰符（public, private, protected）明确类成员的可见性

### 文件命名
- TypeScript 文件使用 `.ts` 扩展名
- React 组件文件使用 `.tsx` 扩展名
- 类型定义文件使用 `.d.ts` 扩展名
- 测试文件使用 `.test.ts` 或 `.spec.ts` 扩展名

### 类型定义
- 为所有函数参数和返回值定义明确的类型
- 使用接口定义对象结构
- 使用类型别名简化复杂类型
- 使用联合类型和交叉类型处理复杂数据结构

### 模块导入导出
- 优先使用 ES6 模块语法（import/export）
- 避免使用 CommonJS 的 require/module.exports
- 使用命名导出而非默认导出（除 React 组件外）
- 为第三方库添加类型定义文件

## 单元测试规范

### 测试框架
- 使用 Jest 作为主要测试框架
- 使用 Supertest 测试 HTTP 接口
- 使用 Testing Library 测试 React 组件

### 测试覆盖率
- 单元测试覆盖率不低于 80%
- 关键业务逻辑必须 100% 覆盖
- 使用 `jest --coverage` 命令检查覆盖率

### 测试文件组织
- 测试文件与被测试文件放在同一目录下，使用 `.test.ts` 或 `.spec.ts` 后缀
- 或者将所有测试文件放在 `__tests__` 目录下
- 每个功能模块应有对应的测试文件

### 测试命名规范
- 测试文件：`*.test.ts` 或 `*.spec.ts`
- 测试套件：使用 `describe` 块描述测试场景
- 测试用例：使用 `it` 或 `test` 描述具体测试行为
- 测试描述：使用清晰、简洁的语言描述测试目的

### 测试编写原则
- 遵循 AAA 模式（Arrange, Act, Assert）
- 每个测试用例只测试一个功能点
- 使用描述性的测试名称
- 避免测试之间的依赖关系
- 使用适当的测试数据，包括边界条件和异常情况

### 测试工具使用
- 使用 `jest.fn()` 创建模拟函数
- 使用 `jest.mock()` 模拟模块依赖
- 使用 `beforeEach` 和 `afterEach` 设置和清理测试环境
- 使用 `beforeAll` 和 `afterAll` 处理一次性设置和清理

### 异步测试
- 使用 `async/await` 处理异步测试
- 使用 `done` 回调或返回 Promise 确保异步操作完成
- 使用 `jest.useFakeTimers()` 控制定时器相关的测试

### 快照测试
- 对 React 组件使用快照测试确保 UI 一致性
- 定期更新快照，确保有意图的变更被记录
- 使用 `.toMatchSnapshot()` 或 `.toMatchInlineSnapshot()`

### 测试运行
- 在提交代码前运行所有测试
- 在 CI/CD 流程中自动运行测试
- 使用 `pnpm test:watch` 进行开发时的持续测试

## TypeScript 与测试集成

### 类型安全测试
- 为测试文件也使用 TypeScript
- 在测试中使用类型断言确保类型安全
- 使用 `as` 类型断言时要谨慎，确保类型转换是安全的

### 测试工具类型定义
- 安装并配置 `@types/jest` 等类型定义包
- 使用类型定义提高测试代码的可维护性
- 为自定义测试工具函数添加类型定义

### 测试覆盖率报告
- 生成详细的测试覆盖率报告
- 配置覆盖率阈值，确保代码质量
- 使用 `coverageThreshold` 设置不同级别的覆盖率要求

## 代码质量工具

### ESLint 配置
```json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:@typescript-eslint/recommended-requiring-type-checking"
  ],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn"
  }
}
```

### Prettier 配置
```json
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 80,
  "parser": "typescript"
}
```

### Husky 和 Lint-Staged
- 使用 Husky 设置 Git 钩子
- 使用 Lint-Staged 在提交前自动运行代码检查和格式化
- 配置 pre-commit 钩子运行测试和代码检查